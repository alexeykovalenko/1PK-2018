```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```


```{r}
library(tidyverse)
library(kableExtra)
library(data.table)
library(ggplot2)
library(cluster) #Библиотека для каластерного анализа
library(captioner) #Библиотка для нумерации таблиц и рисунков и вообще всего
library(treemap) #Библиотека для площадных диаграмм
library(RColorBrewer) #Пакет для цветовых схем для диаграмм
#library(readxl) экспериментировал с импотром из экселя
library(DT) #экспериментировал с datatable
#library(htmltools) экспериментировал с datatable
```

```{r}
# Функция вывода таблицы с помощью библиотеки DT, 
get_dt = function(top_data, col_names = c("Федеральный округ" = "FO_name", "Субъект федерации" = "Subj_Name", "Срез показателя" = "Col_num"), output_file_name) {
  datatable(top_data, colnames = col_names, extensions = 'Buttons',
            escape = FALSE,
            rownames = FALSE,
            filter = 'top',
            options = list(searching = TRUE,
                           pageLength = 10,
                           lengthMenu = c(8, 10, 85, 100),
                           dom = 'Bfrtip',
                           buttons = 
                               list('colvis', list(
                                   extend = 'collection',
                                   buttons = list(list(extend='csv',
                                                       filename = output_file_name),
                                                  list(extend='excel',
                                                       filename = output_file_name)),
                                   text = 'Download'
                               )),
                           scrollX = TRUE,
                           pageLength = nrow(top_data))) 
}

#Функция установки счетчика нумерации для таблиц
table_nums <- captioner(prefix = "Таблица", levels = 2)

#Функция установки счетчика нумерации для таблиц
pic_nums <- captioner(prefix = "Рисунок", levels = 2)


#Функция для импорта данных из csv файлов в переменные R (требует имя файла в кавычках и берет из каталока data рабочей директории проекта)
import_table = function(file_name){
    read_delim(paste0("data/", file_name), ";", 
                 escape_double = FALSE, locale = locale(decimal_mark = ",", 
                 grouping_mark = "", encoding = "WINDOWS-1251"), 
                 trim_ws = TRUE)
}
```


#  Финансово-экономическая деятельность организации {#economic-activity}

## Распределение объема средств организации по источникам их получения и видам деятельности {#source-of-income}

В таблице исходных данных данного раздела значение заголовков столбцов (соотвествуют номерам строк в таблице 6.1 формы 1-ПК 2018):

1. Объем поступивших средств  (за отчетный год) – всего (сумма столбцов  2, 6, 7, 8, 9)
2. Из 1 - средства бюджетов всех уровней (субсидий)  – всего (сумма столбцов 3–5)
3. Из 2 - средства федерального бюджета
4. Из 2 - средства бюджета субъекта РФ
5. Из 2 - средства местного бюджета
6. Из 1 - средства организаций 
7. Из 1 - средства населения
8. Из 1 - средства внебюджетных фондов 
9. Из 1 - средства из иностранных источников

Срезы (соответствуют номерам столбцов  таблицы 6.1 Формы 1-ПК):

3. Пуступления всего по всем видам деятельности (сумма средов 4, 8, 9)
4. Из 3 - образовательная	деятельсность
5. Из 4 - по программам подготовки научно-педагогических кадров, по программам ординатуры 
6. Из 4 - по программам профессионального обучения
7. Из 4 - по дополнительным профессиональным программам
8. Из 3 - научные исследования  и разработки	
9. Из 3 - прочие виды
						


```{r data61_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab61 <- import_table("tab61.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab61[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab61[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab61formation, echo = FALSE}
#Вывод таблицы 6.1 в отчет
get_dt(tab61, , 'tab61_data')
```

## Расходы организации {#expenses}

В таблице исходных данных данного раздела значение заголовков столбцов (соотвествуют номерам строк в таблице 6.2 формы 1-ПК 2018):

1. Расходы  всего, тыс. руб. (сумма столбцов  2, 6, 13, 14)
2. Из 1 - оплата труда и начисления на выплаты по оплате труда (сумма столцов 3–5)
3. Из 2 -заработная плата
4. Из 2 - прочие выплаты
5. Из 2 - начисления на выплаты по оплате труда
6. Из 1 - оплата работ, услуг (сумма столбцов 7–12)
7. Из 6 - услуги связи
8. Из 6 - транспортные услуги
9. Из 6 - коммунальные услуги
10. Из 6 - арендная плата за пользование имуществом
11. Из 6 - работы, услуги по содержанию имущества
12. Из 6. прочие работы, услуги
13. Из 1 - социальное обеспечение
14. ИТ 1 - прочие расходы
15. Поступление нефинансовых активов, всего (сумма столбцов 16-19)
16. Из 15 - увеличение стоимости основных средств
17. Из 15 - увеличение стоимости нематериальных активов
18. Из 15 - увеличение стоимости непроизведенных активов 
19. Из 15 - Увеличение стоимости материальных запасов
20. Наличие программы энергосбережения в организации  (укажите соответствующий код: да –  1;  нет –  0)*
21. Из 1 среза 3: расходы, связанные с содержанием общежитий (тысяча рублей)

* Поскольку при агрегировании по субъектами федерации данные форм отдельных организаций суммируются, числа в столбце 1 среза 3 означает число организаций, который указали в соответствующем поле формы 6.2 единицу. 

Срезы (соответствуют номерам столбцов  таблицы 6.2 Формы 1-ПК):

3. Расходы всего, тыс. руб.	
4. Из 3 - расходы за счет  средств бюджетов  всех уровней (субсидий)
5. Из 4 - за счет средств на выполнение государственного  задания



```{r data62_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab62 <- import_table("tab62.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab62[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab62[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab62formation, echo = FALSE}
#Вывод таблицы 6.2 в отчет
get_dt(tab62, , 'tab62_data')
```

## Сведения о численности и оплате труда работников организации {#salary}

В таблице исходных данных данного раздела значение заголовков столбцов (соотвествуют номерам строк в таблице 6.3 формы 1-ПК 2018):

1. Всего (работников, чел. (срезы 3, 4), фонд начисленной заработной платы, тыс.руб. (срезы 5 - 13)
2. Из 1 - руководящий персонал
3. Из 1 - профессорско-преподавательский состав
4. Из 1 - научные работники
5. Из 1 - инженерно-технический персонал
6. Из 1 - административно-хозяйственный  персонал
7. Из 1 -  производственный  персонал
8. Из 1 - учебно-вспомогательный персонал
9. Из 1 - иной  персонал
10. Количество человек одновременной подготовки (чел), всего
11. Количество человек одновременной подготовки, приведенное к очной форме обучения (с одним десятичным знаком)
12. Среднегодовая численность обучающихся (с одним десятичным знаком) (сумма столбцов 13, 14, 15)
13. Из 12 - по программам подготовки научно-педагогических кадров, ординатуры (чел)
14. Из 12 - по программам профессионального обучения (чел)
15. Из 12 - по программам дополнительным профессиональным программам (чел)


Срезы (соответствуют номерам столбцов  таблицы 6.3 Формы 1-ПК):

3. Средняя численность работников, списочного состава (без внешних совместителей), чел.
4. Средняя численность внешних совместителей, чел. 
5. Фонд начисленной заработной платы работников списочного состава всего (сумма срезов 8, 9, 10)
6. Из 5 - Фонд начисленной заработной платы по внутреннему совместительству
7. Фонд начисленной заработной платы внешних совместителей (сумма срезов 11, 12 и 13)
8. Из 5 - (Фонд начисленной заработной платы работников списочного состава (без внешних совместителей)) за счет средств бюджетов всех уровней (субсидий), тыс. руб.
9. Из 5 - ОМС
10. Из 5 - средства от приносящей доход деятельности
11. Из 7 - (Фонд начисленной заработной платы внешних совместителей) за счет средств бюджетов всех уровней (субсидий), тыс. руб.
12. Из 7 - ОМС
13. Из 7 - средства от приносящей доход деятельности


```{r data63_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab63 <- import_table("tab63.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab63[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab63[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab63formation, echo = FALSE}
#Вывод таблицы 6.3 в отчет
get_dt(tab63, , 'tab63_data')
```

