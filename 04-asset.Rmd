```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```


```{r}
library(tidyverse)
library(kableExtra)
library(data.table)
library(ggplot2)
library(cluster) #Библиотека для каластерного анализа
library(captioner) #Библиотка для нумерации таблиц и рисунков и вообще всего
library(treemap) #Библиотека для площадных диаграмм
library(RColorBrewer) #Пакет для цветовых схем для диаграмм
#library(readxl) экспериментировал с импотром из экселя
library(DT) #экспериментировал с datatable
#library(htmltools) экспериментировал с datatable
```

```{r}
# Функция вывода таблицы с помощью библиотеки DT, 
get_dt = function(top_data, col_names = c("Федеральный округ" = "FO_name", "Субъект федерации" = "Subj_Name", "Срез показателя" = "Col_num"), output_file_name) {
  datatable(top_data, colnames = col_names, extensions = 'Buttons',
            escape = FALSE,
            rownames = FALSE,
            filter = 'top',
            options = list(searching = TRUE,
                           pageLength = 10,
                           lengthMenu = c(8, 10, 85, 100),
                           dom = 'Bfrtip',
                           buttons = 
                               list('colvis', list(
                                   extend = 'collection',
                                   buttons = list(list(extend='csv',
                                                       filename = output_file_name),
                                                  list(extend='excel',
                                                       filename = output_file_name)),
                                   text = 'Download'
                               )),
                           scrollX = TRUE,
                           pageLength = nrow(top_data))) 
}

#Функция установки счетчика нумерации для таблиц
table_nums <- captioner(prefix = "Таблица", levels = 2)

#Функция установки счетчика нумерации для таблиц
pic_nums <- captioner(prefix = "Рисунок", levels = 2)


#Функция для импорта данных из csv файлов в переменные R (требует имя файла в кавычках и берет из каталока data рабочей директории проекта)
import_table = function(file_name){
    read_delim(paste0("data/", file_name), ";", 
                 escape_double = FALSE, locale = locale(decimal_mark = ",", 
                 grouping_mark = "", encoding = "WINDOWS-1251"), 
                 trim_ws = TRUE)
}
```


#  Имущество организации {#assets}

## Наличие  основных фондов {#main-funds}

В таблице исходных данных данного раздела значение заголовков столбцов (соотвествуют номерам строк в таблице 4.1 формы 1-ПК 2018):

1. Основные  фонды, тыс. руб., всего (сумма столбцов  02, 03, 07, 08, 09)
2. Из 1 - здания и сооружения
3. Из 1 - машины, оборудование
4. Из 3 - измерительные и регулирующие приборы и устройства, лабораторное оборудование
5. Из 3 - информационные машины и оборудование (кроме учтенных по ст. 04)
6. Из 5 - исле  вычислительная техника
7. Из 1- библиотечный фонд
8. Из 1 - нематериальные основные фонды 
9. Из 1 - прочие виды основных фондов
10. Из 3 – машины и оборудование дорогостоящие (стоимостью свыше 1 млн руб за единицу)

Срезы (соответствуют номерам столбцов  таблицы 4.1 Формы 1-ПК):

3. Наличие по полной учетной стоимости
4. Из 3 - числе не старше 5 лет


```{r data41_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab41 <- import_table("tab41.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab41[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab41[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab41formation, echo = FALSE}
#Вывод таблицы 4.1 в отчет
get_dt(tab41, , 'tab41_data')
```

##  Общие сведения  о  машинах и оборудовании  (кроме вычислительной техники), используемых  в учебном процессе {#equipment}

В таблице исходных данных данного раздела значение заголовков столбцов (соотвествуют номерам строк в таблице 4.2 формы 1-ПК 2018):

1. Укажите,  использует ли Ваша организация  машины и оборудование  в учебном процессе (1) 
2. Машины и оборудование используются подготовки научно-педагогических кадров, программы ординатуры (возможно  указание одновременно нескольких вариантов, в столбцах 2 - 4) 
3. программ профессионального обучения
4. дополнительных профессиональных программ
5. Используются  машины и оборудование организации
6. Используются  машины и оборудование иных организаций
7. Средний возраст (укажите один из вариантов 7 - 11) машин и оборудования  до 1 года
8. свыше 1 года до 3 лет
9. свыше 3 лет до 5 лет
10. свыше 5 лет до 10 лет
11. свыше 10 лет
12. Доля (один из вариантов в строках 12 - 15) дорогостоящих  машин и  оборудования (стоимостью свыше 1 млн  руб  за единицу) в общей стоимости оборудования (машин),  используемого в учебном процессе до 40%"
13. от 41% до 60%
14. от 61% до 80%
15. свыше 80%
16. Полностью обеспечено машинами и оборудованием (Экспертно оцените (один из вариантов 16 - 20) ситуацию с  машинами и оборудованием, используемым в учебном процессе: на сколько  процентов по отношению к необходимому уровню Ваша организация обеспечена)
17. 75% и выше
18. от 50 до 75%
19. от 25 до 50%
20. до 25%
21. Загруженность машин и оборудования полная (Уровень загруженности (использования) (один из вариантов в строках 21 - 25))
22. 75% и выше
23. от 50 до 75%
24. от 25 до 50%
25. до 25%

Срезы (соответствуют номерам столбцов  таблицы 4.2 Формы 1-ПК):

3. Код 1 – Да; 0 – Нет* (единственный срез)

* Поскольку при агрегировании по субъектами федерации данные форм отдельных организаций суммируются, число в единственном срезе означает число организаций, которые указали в соответствующем поле формы 4.1 единицу. 


```{r data42_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab42 <- import_table("tab42.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab42[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab42[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab42formation, echo = FALSE}
#Вывод таблицы 4.2 в отчет
get_dt(tab42, , 'tab42_data')
```

##  Характеристика здания (зданий) {#buildings}

В таблице исходных данных данного раздела значение заголовков столбцов (соотвествуют номерам строк в таблице 4.3 формы 1-ПК 2018):

1 - 26 Учебно-лабораторные здания (корпус 1, 2, ...,  26 соответственно)

27 - 52 Общежития (Без учета общежитий гостиничного типа) (Здание 1, 2, ..., 26 соответственно)

52 Общежития (Без учета общежитий гостиничного типа) (Здание 26)

53 Число общежитий гостиничного типа (ед)

54 Число номеров (ед) в 53

55 Число мест/коек (ед) в 53

Таким образом, таблица 4.3 предполагает, что характеристики заносятся по зданиями и корпусам и возможно указание информации по 26 учебно-лабораторному корпусу (отдельно по каждому) и по 26 зданию общежитий (отдельно по каждому)


Срезы (соответствуют номерам столбцов  таблицы 4.3 Формы 1-ПК):

3. Здание оборудовано системой виде-онаблюдения
4. Здание имеет охрану
5. Здание специально спроектировано и построено под конкретную организацию
6. Здание доступно для маломобильных групп  населения
7. Год первоначального ввода в эксплуатацию (средний)
8. Год последнего капитального ремонта (3) (средний)
9. Стены зданеия (характеристика материала) каменные
10. кирпичные
11. панельные
12. блочные
13. деревянные
14. монолитные
15. смешанные
16. из прочих стеновых материалов
17. есть доступ Wi-Fi
18. Wi-Fi охватывает более половины площади здания
19. Wi-Fi доступен для  обучающихся


```{r data43_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab43 <- import_table("tab43.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab43[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab43[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab43formation, echo = FALSE}
#Вывод таблицы 4.3 в отчет
get_dt(tab43, , 'tab43_data')
```

##  Наличие и использование площадей {#production-space}

В таблице исходных данных данного раздела значение заголовков столбцов (соотвествуют номерам строк в таблице 4.4 формы 1-ПК 2018):

1. Общая площадь зданий  (помещений) – всего (сумма столбцов 2, 9,11), кв. м.
2. Из 1 площадь учебно-лабораторных зданий (сумма столбцов 3, 5, 6, 7)
3. Из 2 - учебная
4. Из 4 - площадь крытых спортивных сооружений
5. Из 2 - учебно-вспомогательная
6. Из 2 - предназначенная для научно-исследовательских подразделений
7. Из 2 - подсобная
8. Из 7 - из нее площадь пунктов общественного питания
9. Из 1 - площадь общежитий
10 Из 9 - жилая площадь общежитий
11 Из 10 - прочих зданий
12. Общая площадь земельных участков – всего, га
13. Из 12 площадь учебных полигонов
14. Из 12 опытных полей
15. Число учебных мест в  лабораториях (место)
16. Число учебных (рабочих) мест в учебно-производственных  помещениях (мастерских, полигонах, технодромах, учебных цехах и т.п.), всего (место)
17. Из 16 - предоставлено  организациями, с которыми заключены договора на подготовку кадров (место)
18. Количество автоматизированных тренажерно-обучающих  комплексов  (систем) (штука)


Срезы (соответствуют номерам столбцов  таблицы 4.4 Формы 1-ПК):

3. Площадь всего (сумма срезов 9, 10, 11 и 12)
Из 3:
4. сданная в аренду или субаренду
5. находящаяся на капитальном ремонте
6. требующая капитального ремонта
7. находящаяся в аварийном состоянии
8. оборудованная охраннопожарной сигнализацией
Из среза 3 площадь по форме владения, пользования:
9. на правах  собственности
10. в оперативном  управлении
11. арендованная
12. другие формы владения


```{r data44_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab44 <- import_table("tab44.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab44[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab44[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab44formation, echo = FALSE}
#Вывод таблицы 4.4 в отчет
get_dt(tab44, , 'tab44_data')
```

##  Обеспеченность обучающихся общежитиями {#hostel}

В таблице исходных данных данного раздела значение заголовков столбцов (соотвествуют номерам строк в таблице 4.5 формы 1-ПК 2018):

1. Численность  обучающихся, которые нуждались в общежитиях, всего, человек
2. Из 1 проживалов общежитиях гостиничного типа
3. Из 1 проживало в общежитиях, арендуемых у сторонних  организаций

Срезы (соответствуют номерам столбцов  таблицы 4.5 Формы 1-ПК):

3. Лица, осваивающие программы подготовки научнопедагогических кадров, программы ординатуры
4. Лица, осваивающие программы профессионального обучения
5. Лица, осваивающие дополнительные профессиональные программы


```{r data45_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab45 <- import_table("tab45.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab45[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab45[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab45formation, echo = FALSE}
#Вывод таблицы 4.5 в отчет
get_dt(tab45, , 'tab45_data')
```

##  Наличие мест общественного питания {#public-catering}

В таблице исходных данных данного раздела значение заголовков столбцов (соотвествуют номерам строк в таблице 4.6 формы 1-ПК 2018):

1. Число посадочных мест в собственных (без сданных в аренду и субаренду) и арендованных предприятиях (подразделениях) общественного питания
2. Из 1 - в том числе фактически используется
3. Число посадочных мест на предприятиях (подразделениях) общественного питания, сданных в аренду и субаренду

Срезы (соответствуют номерам столбцов  таблицы 4.6 Формы 1-ПК):

3. Учебно-лабораторные здания (корпуса)
4. Общежития (Без учета общежитий гостиничного типа)


```{r data46_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab46 <- import_table("tab46.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab46[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab46[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab46formation, echo = FALSE}
#Вывод таблицы 4.6 в отчет
get_dt(tab46, , 'tab46_data')
```

