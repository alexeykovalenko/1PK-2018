```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```


```{r}
library(tidyverse)
library(kableExtra)
library(data.table)
library(ggplot2)
library(cluster) #Библиотека для каластерного анализа
library(captioner) #Библиотка для нумерации таблиц и рисунков и вообще всего
library(treemap) #Библиотека для площадных диаграмм
library(RColorBrewer) #Пакет для цветовых схем для диаграмм
#library(readxl) экспериментировал с импотром из экселя
library(DT) #экспериментировал с datatable
#library(htmltools) экспериментировал с datatable
```

```{r}
# Функция вывода таблицы с помощью библиотеки DT, 
get_dt = function(top_data, col_names = c("Федеральный округ" = "FO_name", "Субъект федерации" = "Subj_Name", "Срез показателя" = "Col_num"), output_file_name) {
  datatable(top_data, colnames = col_names, extensions = 'Buttons',
            escape = FALSE,
            rownames = FALSE,
            filter = 'top',
            options = list(searching = TRUE,
                           pageLength = 10,
                           lengthMenu = c(8, 10, 85, 100),
                           dom = 'Bfrtip',
                           buttons = 
                               list('colvis', list(
                                   extend = 'collection',
                                   buttons = list(list(extend='csv',
                                                       filename = output_file_name),
                                                  list(extend='excel',
                                                       filename = output_file_name),
                                                  list(extend='pdf',
                                                       filename= output_file_name)),
                                   text = 'Download'
                               )),
                           scrollX = TRUE,
                           pageLength = nrow(top_data))) 
}

#Функция установки счетчика нумерации для таблиц
table_nums <- captioner(prefix = "Таблица", levels = 2)

#Функция установки счетчика нумерации для таблиц
pic_nums <- captioner(prefix = "Рисунок", levels = 2)


#Функция для импорта данных из csv файлов в переменные R (требует имя файла в кавычках и берет из каталока data рабочей директории проекта)
import_table = function(file_name){
    read_delim(paste0("data/", file_name), ";", 
                 escape_double = FALSE, locale = locale(decimal_mark = ",", 
                 grouping_mark = "", encoding = "WINDOWS-1251"), 
                 trim_ws = TRUE)
}
```



# Сведения о численности слушателей, обученных по  дополнительным профессиональным программам {#students}

## Распределение слушателей по программам {#students-distribution}

В таблице исходны данных данного раздела значение заголовков столбцов (соотвествуют номерам строк в таблице 2.1 формы 1-ПК 2018):

1. Численность слушателей – всего (сумма строк  02,04,23, 25 – 27,29,32,37)
2. Из 1 работники предприятий и  организаций
3. из них 2 - руководители
4. Из 1 работники образовательных организаций 
5. Из 4 - руководители образовательных организаций (сумма срезов 06-13) в том числе:
6. Из 5 - руководители дошкольных образовательных организаций
7. Из 5 - руководители общеобразовательных организаций
8. ИЗ 5 - руководители профессиональных образовательных организаций
9. Из 5 - руководители многофункциональных центров прикладных квалификаций
10. Из 5 - руководители образовательных организаций высшего образования
11. Из 5 - руководители организаций дополнительного  профессионального образования
12. Из 5 - руководители организаций дополнительного образования, реализующих дополнительные общеобразовательные программы для детей
13. Из 5 - руководители организаций дополнительного образования, реализующих дополнительные общеразвивающие  программы для взрослых
14. Из 4 - педагогические работники (сумма  срезов 15–22) в том числе:
15. Из 15 работники дошкольных образовательных организаций
16. Из 15 работники общеобразовательных организаций
17. Из 15 работники профессиональных образовательных организаций
18. Из 15 работники многофункциональных центров прикладных квалификаций
19. Из 15 работники образовательных организаций высшего образования
20. Из 15 работники организаций дополнительного профессионального образования
21. Из 15 работники организаций дополнительного образования, реализующих дополнительные общеобразовательные программы для детей
22. Из 15 работники организаций дополнительного образования, реализующих дополнительные общеразвивающие  программы для взрослых
23. Из 1 лица, замещающие государственные должности и должности государственной гражданской службы, в том числе:
24. Из 23 - руководители
25. Из 1 - Лица, замещающие муниципальные должности и должности муниципальной  службы
26. Из 1 - Лица, уволенные с военной службы
27. Из 1 - Лица по направлению службы занятости, из них:
28. Из 27 - безработные
29. Из 1 - Студенты, обучающиеся по образовательным программам среднего профессионального образования (сумма строк 30,31):
30. Из 29 - по программам подготовки квалифицированных рабочих, служащих
31. Из 29 - по программам подготовки специалистов среднего звена
32. Из 1 - Студенты, обучающиеся по программам высшего образования (сумма строк 33-36) в том числе по программам:
33. Из 32 - по программам бакалавриата
34. Из 32 - по программам специалитета
35. Из 32 - по программам магистратуры
36. Из 32 - по программам подготовки кадров высшей квалификации
37 Из 1 - другие слушатели
38. Из численности слушателей (из суммы срезов  02, 04, 23, 25 – 27, 37) имеют образование:
39. Из 38 - имеют среднее профессиональное (сумма строк 39,40), в том числе:
40. Из 39 - по программам подготовки квалифицированных рабочих, служащих
41. Из 39 - по программам подготовки специалистов среднего звена
42. Из 38 - высшее (сумма строк 42-45) в том числе подтвержденное дипломом:
43. Из 42 - бакалавра
44. Из 42 - специалиста
45. Из 42 - магистра
46. Из 42 - об окончании аспирантуры (адьюнктуры), ординатуры, ссистентуры-стажировки
47. Из общей численности слушателей (из среза 1) - инвалиды
48. Из 1 - дети-инвалиды 

Срезы (соответствуют номерам столбцов  таблицы 2.1 Формы 1-ПК):

3. Всего слушателей, обученных по дополнительным профессиональным  программам (сумма срезов 4 и 7), всего, человек
4. Из 3 обучено по программам повышения квалификации повышения квалификации
5. Из 4 обучено по программам повышения квалификации от 16 до 72 часов
6. Из 4 обучено по программам повышения квалификации свыше 72 часов
7. Из 3 обучено по программам профессиональной переподготовки всего
8. Из 7 обучено по программам профессиональной переподготовки по программам от 250 до 500 часов
9. Из 7 обучено по программам профессиональной переподготовки по программам свыше 500 часов
10. Из 7 с присвоением новой квалификации
11. Из 3 обучено в форме стажировки (полностью или частично) 
12. Из 11 по программам повышения квалификации
13. Из 11 по программам профессиональной переподготовки
14. Из 3 женщины



```{r data21_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab21 <- import_table("tab21.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab21[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab21[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab21formation, echo = FALSE}
#Вывод таблицы 2.1 в отчет
get_dt(tab21, , 'tab21_data')
```



## Распределение слушателей по программам  и источникам финансирования обучения {#funding-distribution}

```{r data22_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab22 <- import_table("tab22.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab22[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab22[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab22formation, echo = FALSE}
#Вывод таблицы 2.2 в отчет
get_dt(tab22, , 'tab22_data')
```


## Распределение лиц, обученных по дополнительным профессиональным программам, по формам обучения {#form-distribution}

```{r data23_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab23 <- import_table("tab23.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab23[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab23[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab23formation, echo = FALSE}
#Вывод таблицы 2.2 в отчет
get_dt(tab23, , 'tab23_data')
```


## Распределение лиц,обученных по дополнительным профессиональным программам,по укрупненным группам специальностей (направлений подготовки) и программам {#spec-distribution}

### Программы повышения квалификации {#spec-distribution-pk}

```{r data241_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab241 <- import_table("tab241.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab241[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab241[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab241formation, echo = FALSE}
#Вывод таблицы 2.2 в отчет
get_dt(tab241, , 'tab241_data')
```


### Профессиональная переподготовка {#spec-distribution-pp}

```{r data242_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab242 <- import_table("tab242.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab242[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab242[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab242formation, echo = FALSE}
#Вывод таблицы 2.2 в отчет
get_dt(tab242, , 'tab242_data')
```


## Распределение слушателей по возрасту, полу и программам {#demography-distribution}

```{r data25_import, echo = FALSE}
#Чтение таблицы исходных данных подраздела запись данных в переменную
tab25 <- import_table("tab25.csv")

#Факторизация переменных "Федеральный округ", "Субъект федерации", "Срез"
tab25[c("FO_name", "Subj_Name", "Col_num")] <- lapply(tab25[c("FO_name", "Subj_Name", "Col_num")] , factor)

```



```{r tab25formation, echo = FALSE}
#Вывод таблицы 2.2 в отчет
get_dt(tab25, , 'tab25_data')
```
